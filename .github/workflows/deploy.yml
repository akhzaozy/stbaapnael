name: ğŸš€ Auto Deploy (Lite Mode)

on:
  push:
    branches:
      - main
      - development
      - feature/**
  workflow_dispatch:

jobs:
  deploy:
    name: ğŸ”§ Lite Deploy
    runs-on: ubuntu-latest

    steps:
      # 1ï¸âƒ£ Checkout repo
      - name: Checkout Repository
        uses: actions/checkout@v4

      # 2ï¸âƒ£ Zip cepat (tanpa vendor/node_modules)
      - name: Create ZIP
        run: |
          zip -r deploy.zip . \
            -x "*.git*" "*.github*" "node_modules/*" "vendor/*" "storage/*" "*.env" "*.log"

      # 3ï¸âƒ£ Kirim file ke server (cepat, tidak nunggu composer)
      - name: Upload to Kucingarong Lite
        env:
          AUTOHOST_URL: "https://cicak.akhzafachrozy.my.id/deploy-lite.php"  # endpoint baru
          REPO_NAME: ${{ github.event.repository.name }}
        run: |
          echo "ğŸš€ Uploading $REPO_NAME..."
          RESPONSE=$(curl -s -S -k -m 60 --connect-timeout 10 \
            -X POST \
            -F "repo=$REPO_NAME" \
            -F "file=@deploy.zip" \
            "$AUTOHOST_URL")
          echo "ğŸ“œ ===== RESPONSE ====="
          echo "$RESPONSE"
          echo "ğŸ“œ ===================="

      # 4ï¸âƒ£ Bersihkan file
      - name: Cleanup workspace
        run: rm -f deploy.zip
